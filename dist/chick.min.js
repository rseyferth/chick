"use strict";!function(){window.Chick=window.Chick||{},_.mixin(window.s.exports()),Chick.register=function(t,e,i){var r=void 0===i?e:i,n=void 0===i?!1:e;n&&(r.prototype=Object.create(n.prototype),r.prototype.constructor=r);var o=t.split("."),s=window.Chick;if(o.length>1)for(var a=0;a<o.length-1;a++)void 0===s[o[a]]&&(s[o[a]]={}),s=s[o[a]];return s[o[o.length-1]]=r||{},s[o[o.length-1]]},Chick.registerController=function(t,e){return Chick.register(t,Chick.Core.Controller,e)},Chick.registerModel=function(t,e){return Chick.register("Models."+t,Chick.Core.Model,e)},Chick.knows=function(t){var e=Chick.arrayGet(Chick,t,!1);return e!==!1},Chick.createModel=function(t,e){return Chick.Core.Model.create(t,e)},Chick.view=function(t){return Chick.Gui.View.make(t)},Chick.isModel=function(t){return"object"==typeof t&&Chick.Core.Model.prototype.isPrototypeOf(t)},Chick.isCollection=function(t){return"object"==typeof t&&Chick.Core.Collection.prototype.isPrototypeOf(t)},Chick.promise=function(){return $.Deferred()},Chick.isPromise=function(t){return"object"==typeof t&&"function"==typeof t.then},Chick.isArray=function(t){return $.isArray(t)},Chick.when=function(t){return $.when.apply(null,t)},Chick.uuid=function(t){void 0===t&&(t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx");var e=((new Date).getTime(),t.replace(/[xy]/g,function(t){var e=16*Math.random()|0,i="x"===t?e:3&e|8;return i.toString(16)}));return e},Chick.extend=function(){return $.extend.apply(this,arguments)},Chick.arrayGet=function(t,e,i,r){void 0===r&&(r=/\./),void 0===i&&(i="["+e+"]");var n=e.split(r);for(var o in n){if(void 0===t[n[o]])return i;t=t[n[o]]}return t},Chick.__contentProcessors=[],Chick.registerContentProcessor=function(t){Chick.__contentProcessors.push(t)},Chick.enableContent=function(t,e){for(var i in Chick.__contentProcessors)Chick.__contentProcessors[i](t,e)},Chick.redirect=function(t){return new Chick.Core.Redirect(t)},Chick.gotoUri=function(t){return t=Chick.url(t),Chick.app.router.open(t)};var t=new window.DotObject;window.dot=t,"function"!=typeof Object.create&&(Object.create=function(){var t=function(){};return function(e){if(arguments.length>1)throw new Error("Second argument not supported");if("object"!=typeof e)throw new TypeError("Argument must be an object");t.prototype=e;var i=new t;return t.prototype=null,i}}()),void 0===window.console&&(window.console={log:function(){},warn:function(){},error:function(){}}),Chick.directiveClasses={},Chick.createdDirectives=[],Chick.registerDirective=function(t,e,i){return e=Chick.register("Directives."+_.classify(t),Chick.Gui.Directive,e),e.prototype.__construct=i,Chick.directiveClasses[t]=e,e},Chick.getDirectiveInstance=function(t){return Chick.createdDirectives[t]};var e={};Chick.broadcast=function(t,i,r){void 0!==e[t]&&_.each(e[t],function(t){t.apply(r,i)})},Chick.listen=function(t,i){"string"==typeof t&&(t=t.split(/\s*,\s*/)),_.each(t,function(t){void 0===e[t]&&(e[t]=[]),e[t].push(i)})},Chick.unlisten=function(t,i){void 0!==e[t]&&(e[t]=_.without(e[t],i))}}(),function(t){function e(){}t.register("Core.TriggerClass",e),e.prototype.on=function(t,e){return this.__callbacks[t].push(e),this},e.prototype.once=function(t,e){return this.__callbacksOnce[t].push(e),this},e.prototype.trigger=function(t){var e=[];if(arguments.length>1)for(var i=1;i<arguments.length;i++)e.push(arguments[i]);var r=this;return _.each(this.__callbacks[t],function(t){t.apply(r,e)}),_.each(this.__callbacksOnce[t],function(t){t.apply(r,e)}),this.__callbacksOnce[t]=[],this},e.prototype.triggerAndReturn=function(t){var e=[];if(arguments.length>1)for(var i=1;i<arguments.length;i++)e.push(arguments[i]);var r=this,n=[];return _.each(this.__callbacks[t],function(t){n.push(t.apply(r,e))}),_.each(this.__callbacksOnce[t],function(t){n.push(t.apply(r,e))}),this.__callbacksOnce[t]=[],n.filter(function(t){return void 0!==t})},e.prototype.__registerEvents=function(t){void 0===this.__callbacks&&(this.__callbacks={}),void 0===this.__callbacksOnce&&(this.__callbacksOnce={});for(var e in t)this.__callbacks[t[e]]=[],this.__callbacksOnce[t[e]]=[]}}(Chick),function(t){function e(){}e.prototype.resolve=function(){if(this.__init(),this.__isResolved||this.__isRejected)throw new Error("A Promise can only be resolved or rejected once.");return this.__isResolved=!0,this.__result=arguments,this.__callListeners("resolve"),this},e.prototype.reject=function(){if(this.__init(),this.__isResolved||this.__isRejected)throw new Error("A Promise can only be resolved or rejected once.");return this.__isRejected=!0,this.__result=arguments,this.__callListeners("reject"),this},e.prototype.then=function(t,e){return void 0!==t&&this.__addListener("resolve",t),void 0!==e&&this.__addListener("reject",e),this},e.prototype.always=function(t){return this.__addListener("any",t),this},e.prototype.done=function(t){return this.__addListener("resolve",t),this},e.prototype.fail=function(t){return this.__addListener("reject",t),this},e.prototype.__init=function(){this.__initialized!==!0&&(this.__isResolved=!1,this.__isRejected=!1,this.__result=void 0,this.__resolveListeners=[],this.__rejectListeners=[],this.__anyListeners=[],this.__initialized=!0)},e.prototype.__callListeners=function(t){var e="resolve"===t?this.__resolveListeners:this.__rejectListeners;e=e.concat(this.__anyListeners);for(var i in e)e[i].apply(null,this.__result)},e.prototype.__addListener=function(t,e){this.__init(),this.__isResolved&&"resolve"===t||this.__isRejected&&"reject"===t||(this.__isRejected||this.__isResolved)&&"any"===t?e.apply(null,this.__result):"resolve"===t?this.__resolveListeners.push(e):"reject"===t?this.__rejectListeners.push(e):"any"===t&&this.__anyListeners.push(e)},t.register("Core.Promise",e)}(Chick),function(t){function e(){this.__init()}t.register("Core.Model",e),void 0===t.Models&&(t.Models={}),e.prototype.deserialize=function(t){_.extend(this.__attributes,t),void 0!==this.__attributes.links&&(_.extend(this.__links,this.__attributes.links),delete this.__attributes.links)},e.prototype.get=function(e){if(e.indexOf(".")>0){for(var i=this,r=e.split("."),n=/^{([a-zA-Z0-9]+)}$/,o=0;o<r.length;o++)if(n.test(r[o])){var s=n.exec(r[o])[1];"last"===s?i=t.Core.Collection.prototype.isPrototypeOf(i)?i.last():_.last(i):"first"===s?i=t.Core.Collection.prototype.isPrototypeOf(i)?i.first():_.first(i):"all"===s||(i=t.Core.Collection.prototype.isPrototypeOf(i)?i.get(s):i[s])}else{var a;if(t.isArray(i))return a=r.slice(o,r.length).join("."),_.map(i,function(t){return t.get(a)});if(t.Core.Collection.prototype.isPrototypeOf(i))return a=r.slice(o,r.length).join("."),i.map(function(t){return t.get(a)});if(void 0===i)return null;if(!t.Core.Model.prototype.isPrototypeOf(i)){i=i[r[o]];continue}i=i.get(r[o])}return i}var c="get"+inflection.camelize(e);if("function"==typeof this[c])return this[c]();if(void 0!==this.__links[e])return this.__links[e];if(void 0!==this.constructor.dates&&-1!==_.indexOf(this.constructor.dates,e))return moment(this.__attributes[e]);if(void 0!==this.constructor.embedded&&void 0!==this.constructor.embedded[e]&&!t.Core.Collection.prototype.isPrototypeOf(this.__attributes[e])){for(var u=this.__attributes[e],h=t.Models[this.constructor.embedded[e]],l=new t.Core.Collection(h),p=0;p<u.length;p++){var f=new h;f.deserialize(u[p]),l.add(f)}this.__attributes[e]=l}return this.__attributes[e]},e.prototype.set=function(t,e){if(t.indexOf(".")>0){var i=t.split("."),r=i.pop(),n=i.join("."),o=this.get(n);console.log("I want to set ",r," of ",o)}else{var s="set"+inflection.camelize(t);if("function"==typeof this[s])return this[s](e);if(moment.isMoment(e)&&(e=moment.toIsoString()),e===this.__attributes[t])return;this.__dirty[t]=e,this.__attributes[t]=e}},e.prototype.each=function(e,i){var r=this.get(e);t.Core.Collection.prototype.isPrototypeOf(r)?r.each(i):_.each(r,i)},e.prototype.toArray=function(){var t=_.extend(this.__attributes);return _.each(this.__links,function(e,i){$.isArray(e)?t[i]=_.map(e,function(t){return t.toArray()}):"object"==typeof e&&(t[i]=e.toArray())}),t},e.prototype.hasLink=function(t){return void 0!==this.__links[t]},e.prototype.enrich=function(e,i){if(-1!==e.indexOf(".")){for(var r=e.split("."),n=r.pop(),o=this;r.length>0&&void 0!==o;){var s=r.shift();if("function"!=typeof o.get)return!1;if(o=o.get(s),t.Core.Collection.prototype.isPrototypeOf(o))return r.push(n),o.enrich(r.join("."),i)}e=n}if(void 0===this.__links[e])return!1;if("string"==typeof this.__links[e]||"number"==typeof this.__links[e]){var a=i.getByPK(this.__links[e]);return void(a&&(this.__links[e]=a))}this.__links[e]=_.map(this.__links[e],function(t){if("object"!=typeof t){var e=i.getByPK(t);return e?e:t}});for(var c=this.__links[e].length>0?this.__links[e][0].constructor:t.Core.Model,u=new t.Core.Collection(c),h=0;h<this.__links[e].length;h++)u.add(this.__links[e][h]);this.__links[e]=u},e.prototype.loadLink=function(e,i,r){var n=t.promise(),o=this;return t.api(i,r).then(function(t){o.__links[e]=_.keys(t.records.__recordsByPK),o.enrich(e,t.records),n.resolve()}),n},e.prototype.__init=function(){this.__primaryKey="id",this.__attributes={},this.__dirty={},this.__links={}},e.prototype.getPrimary=function(){return this.__attributes[this.__primaryKey]},e.prototype.isNew=function(){return void 0===this.__attributes[this.__primaryKey]||null===this.__attributes[this.__primaryKey]},e.prototype.getApiUrl=function(){var t=this.constructor.apiUrl;return t||(t="/"+_.underscored(this.constructor.name)),this.isNew()||(t+="/"+this.__attributes[this.__primaryKey]),t},e.prototype.save=function(){var t=this,e=_.omit(this.__attributes,this.__primaryKey),i=this.getApiUrl(),r=this.isNew()?"post":"put",n=this.isNew()?"create":"update",o=Chick.promise();Chick.Net.Api.call(i,e,{method:r}).then(function(e){t.__attributes=e.records.first().__attributes,Chick.broadcast(t.constructor.name+"."+n,[t]),o.resolve(e)}).fail(function(t){o.reject(t)});return o},e.prototype.destroy=function(){var t=this.getApiUrl(),e=this;return Chick.Net.Api.call(t,{},{method:"delete"}).then(function(){Chick.broadcast(e.constructor.name+".destroy",[e])})},e.create=function(e,i){var r=t.Models[e];if(void 0===r)throw"Unknown model class "+e;var n=new r;return i&&n.deserialize(i),n}}(Chick),function(t){function e(e){void 0===e&&(e=t.Core.Model),this.modelClass=e,this.__records=[],this.__recordsByPK={}}t.register("Core.Collection",e),e.prototype.add=function(t){if(e.prototype.isPrototypeOf(t)){var i=this;return void t.each(function(t){i.add(t)})}this.__records.push(t);var r=t.getPrimary();r&&(this.__recordsByPK[r]=t)},e.prototype.first=function(){return this.__records[0]||null},e.prototype.last=function(){return _.last(this.__records)},e.prototype.get=function(t){return this.__records[t]||null},e.prototype.getByPK=function(t){return this.__recordsByPK[t]||null},e.prototype.count=function(){return this.__records.length},e.prototype.each=function(t){for(var e=0;e<this.__records.length;e++)t(this.__records[e],e)},e.prototype.map=function(t){for(var e=[],i=0;i<this.__records.length;i++)e.push(t(this.__records[i],i));return e},e.prototype.list=function(t,e){for(var i,r=[],n=0;n<this.__records.length;n++)i=this.__records[n].get(t),void 0===e?r.push(i):r[this.__records[n].get(e)]=i;return r},e.prototype.find=function(t){return _.find(this.__records,t)},e.prototype.findBy=function(t,e){return _.find(this.__records,function(i){return i.get(t)===e})},e.prototype.filter=function(t){for(var i=new e(this.modelClass),r=0;r<this.__records.length;r++)if("function"==typeof t)t(this.__records[r])===!0&&i.add(this.__records[r]);else{var n=!0;for(var o in t){var s=this.__records[r].get(o);if(s!==t[o]){n=!1;break}}n&&i.add(this.__records[r])}return i},e.prototype.listUnique=function(t){return _.uniq(this.list(t))},e.prototype.sortBy=function(t){return this.__records=_.sortBy(this.__records,t),this},e.prototype.groupBy=function(t,e){if("string"==typeof t){var i=t;t=function(t){return t.get(i)}}return _.groupBy(this.__records,t,e)},e.prototype.toArray=function(){return this.__records},e.prototype.enrich=function(t,e){this.each(function(i){i.enrich(t,e)})}}(Chick),function(t){function e(){}e.prototype.setRequest=function(t){this.request=t},t.register("Core.Controller",e)}(Chick),function(t){function e(e,i){void 0===e&&(e=window.location),void 0===i&&(i=t.app.router),this.uri=null,this.data={},this.method="get",this.language=!1,this.anchor=!1,"string"!=typeof e&&(e=""+e),this.url=e,e="/"+e.replace(/^http(s)?\:\/\/[a-zA-Z\.0-9\:\-]+\//,"");var r=e.indexOf("?");if(-1!==r){var n=e.substr(r+1),o=n.split(/\&/);for(var s in o){for(var a,c=o[s].replace(/\+/g," ").split(/=/),u=decodeURIComponent(c[0]),h=decodeURIComponent(c[1]),l=/\[([a-zA-Z0-9]*)\]/g,p=this.data;null!==(a=l.exec(u));){var f=a[1],d=u.substr(0,a.index);void 0===p[d]&&(p[d]={}),p=p[d],u=f}p[u]=h}e=e.substr(0,r)}var _=e.split(/#/);if(_.length>1&&(e=_[0],this.anchor=_[1]),this.fullPath=e,i.baseUrl.length>0&&0===e.indexOf(i.baseUrl)&&(e=e.substr(i.baseUrl.length)),i.languageRegex!==!1){var v=i.languageRegex.exec(e);v?(this.language=v[1],e=e.substr(v[0].length)):this.language=i.settings.languages[0]}e=e.replace(/\/$/,""),this.uri=e}t.register("Core.Request",e)}(Chick),function(t){function e(e,r,n){var o=this;this.pattern=e;var s=t.extend({actions:r,parentRoute:!1,"abstract":!1},n);if(this.id=++i,this.method=s.method,this.parameterRestrictions={},this.hasRestrictions=!1,this.parentRoute=s.parentRoute,this.subRoutes=[],this.actions={},_.each(s.actions,function(e,i){if("string"==typeof e){var r=/^(\w+)@(\w+)$/.exec(e);if(!r)throw'Did not understand action "'+e+'". Use Controller@action format.';e={controller:r[1],action:r[2]}}else e=t.extend({action:"index"},e);if(void 0===e.controller)throw"A route action needs a controller at the very least. Use 'ControllerName@methodAction'.";o.actions[i]=e}),0===_.size(this.actions))throw"A route needs at least 1 action!"}var i=0;t.register("Core.Route",e),e.prototype.match=function(e){if(this["abstract"])return!1;if("string"==typeof e&&(e=new t.Core.Request(e)),e.method!==this.method)return!1;if(void 0===this.regex&&this.__createRegEx(),this.regex.test(e.uri)===!1)return!1;if(this.hasRestrictions===!1)return!0;var i=this.regex.exec(e.uri),r=i.slice(1,1+this.parameters.length);for(var n in this.parameters){var o=this.parameterRestrictions[this.parameters[n]];if(void 0!==o)for(var s in o)if(o[s].test(r[n])===!1)return!1}return!0},e.prototype.getActions=function(){return this.parentRoute===!1?this.actions:_.extend(this.parentRoute.getActions(),this.actions)},e.prototype.getActionQueue=function(t){for(var e=this,i=[];e!==!1;)i.unshift(e),e=e.parentRoute;for(var r={},n=0;n<i.length;n++)e=i[n],_.each(e.actions,function(i,n){var o=t.slice(0,e.parameters.length);r[n]={route:e,routeParams:o,key:n,action:i}});return r},e.prototype.execute=function(e){var i=this;if("string"==typeof e&&(e=new t.Core.Request(e)),e.method!==this.method)return!1;var r=this.regex.exec(e.uri),n=r.slice(1,1+this.parameters.length),o=Chick.promise(),s=t.app.router.controllerNamespace;s=s?s+".":"";var a={},c=this.getActionQueue(n),u=_.keys(c),h=function(){if(0===u.length)return void o.resolve(a);var r=u.shift(),n=c[r],l=n.action,p=t.app.getViewContainer(n.key);if(0!==u.length&&p.isLastSetBy(n.route,n.routeParams))return void h();var f=s+l.controller,d=Chick.arrayGet(Chick,f,null);if(!d)throw"There is no controller defined as "+f;var _=new d;if(_.setRequest(e),void 0===_[l.action])throw"The controller does not have a method "+l.action;var v=_[l.action].apply(_,n.routeParams);i.__processResponse(r,v).then(function(e){a[r]=v,t.app.router.trigger("actionComplete",[r,e,this]),p.setContent(e,n.route,n.routeParams),h()})};return h(),o},e.prototype.leave=function(t){return this.view?this.view.leave(t):!0},e.prototype.having=function(t,e){return void 0===this.parameterRestrictions[t]&&(this.parameterRestrictions[t]=[]),this.parameterRestrictions[t].push(e),this.hasRestrictions=!0,this},e.prototype.sub=function(e){var i=this,r={get:function(e,r,n){return void 0===n&&(n={}),n.parentRoute=i,t.app.router.get(e,r,n)},post:function(e,r,n){return void 0===n&&(n={}),n.parentRoute=i,t.app.router.post(e,r,n)}};e.apply(r)},e.prototype.__processResponse=function(e,i,r){if(void 0===r&&(r=t.promise()),i===!1)r.reject(404);else if(t.knows("Gui.View")&&t.Gui.View.prototype.isPrototypeOf(i))this.view=i,this.view.render().then(function(t){r.resolve(t)});else if(t.Core.Redirect.prototype.isPrototypeOf(i))t.app.router.open(i.url);else if("object"==typeof i&&"function"==typeof i.then){var n=this;i.then(function(t){n.__processResponse(e,t,r)})}else r.resolve(i);return r},e.prototype.__getPattern=function(){for(var t=this.pattern,e=this.parentRoute;e!==!1;)t=e.pattern+t,e=e.parentRoute;return t},e.prototype.__createRegEx=function(){var t=[],e=this.__getPattern().replace(/\/:([a-zA-Z]+)/g,function(e,i){return t.push(i),"/([-a-zA-Z0-9,.]+)"}).replace(/\/{([a-zA-Z]+)}/g,function(e,i){return t.push(i),"/([-a-zA-Z0-9,.]+)"}).replace(/\/{\#([a-zA-Z]+)}/g,function(e,i){return t.push(i),"/([0-9]+)"}).replace(/\/{\*([a-zA-Z]+)}/g,function(e,i){return t.push(i),"/(.+)"});e=e.replace(/\/$/,""),e=e.replace(/\//g,"\\/"),this.regex=new RegExp("^"+e+"$"),this.parameters=t}}(Chick),function(t){function e(e){this.__registerEvents(["navigationStart","navigationComplete","error","pageNotFound","selectLanguage","actionComplete"]),this.settings=t.extend({baseUrl:"/",catchLinks:!0,catchForms:!1,controllerNamespace:null},e),this.baseUrl=this.settings.baseUrl.replace(/\/$/,""),this.languageRegex=!1,this.controllerNamespace=this.settings.controllerNamespace,this.routes=[],this.activeRoute=null;var i=this;History.Adapter.bind(window,"statechange",function(){var t=History.getState();i["goto"](t.cleanUrl)}),this.settings.catchLinks&&t.registerContentProcessor(function(t){var e=t.find("a").not('[href^="http"]').not('[href^="#"]').not('[href^="//"]');e.on("click",function(t){t.preventDefault(),History.pushState(null,null,$(this).attr("href"))})}),this.settings.catchForms&&t.registerContentProcessor(function(t){t.find("form").not('[action^="http"]').on("submit",function(t){var e=$(this);t.preventDefault();var i=function(t){History.pushState(null,null,e.attr("action")+"?"+e.serialize())};e.on("formSubmit",i),e.trigger("formSubmit"),e.off("formSubmit",i)})})}t.register("Core.Router",t.Core.TriggerClass,e),e.prototype.get=function(t,e,i){return void 0===i&&(i={}),i.method="get",this.add(t,e,i)},e.prototype.post=function(t,e,i){return void 0===i&&(i={}),i.method="post",this.add(t,e,i)},e.prototype.detectLanguage=function(){var e=new t.Core.Request;return e.language},e.prototype.languages=function(t){return this.settings.languages=t,t===!1?this.languageRegex=!1:this.languageRegex=new RegExp("/("+t.join("|")+")"),this},e.prototype.add=function(e,i,r){var n=new t.Core.Route(e,i,r);return this.routes.push(n),n.parentRoute!==!1&&n.parentRoute.subRoutes.push(n),n},e.prototype.open=function(t){return History.pushState(null,null,t),this},e.prototype.redirect=function(t){return History.replaceState(null,null,t),this},e.prototype.switchLanguage=function(t){var e=this.lastRequest,i=e.url.replace("/"+e.language+"/","/"+t+"/");return""===e.uri&&(i="/"+t),this["goto"](i)},e.prototype["goto"]=function(e){var i=t.Core.Request.prototype.isPrototypeOf(e)?e:new t.Core.Request(e),r=this;if(this.lastRequest=i,i.language!==!1&&i.language!==t.app.language){if(this.settings.refreshOnLanguageSwitch)return void(window.location=i.url);this.trigger("selectLanguage",i.language)}var n=t.promise();if(this.activeRoute){var o=this.activeRoute.leave(i);if(o===!1)return;t.isPromise(o)?o.then(function(){n.resolve()}):n.resolve()}else n.resolve();n.then(function(){r.trigger("pageLoadStart",i.uri,i);var t=!1;for(var e in r.routes)if(r.routes[e].match(i)){t=r.routes[e];break}t===!1?(r.trigger("error",404),r.trigger("pageNotFound")):(r.activeRoute=t,t.execute(i).then(function(t){r.trigger("navigationComplete",t)}).fail(function(t){r.trigger("error",t)}))})},e.prototype.start=function(){var t=History.getState();return this["goto"](t.cleanUrl)}}(Chick),function(t){function e(t){this.url=t}t.register("Core.Redirect",e)}(Chick);var ns=Chick.register("Net.Api",{config:{baseUrl:"/api/v1",key:"",urlSuffix:""},configure:function(t){return _.extend(this.config,t)},call:function(t,e,i,r){return new Chick.Net.ApiCall(t,e,i,r)},createUrl:function(t){var e=this.config.baseUrl+t+this.config.urlSuffix;return e},cache:function(t,e,i){if(void 0===e){if(e=localStorage["Chick-api-cache."+t],!e)return;var r=moment(),n=moment(e.substr(0,moment().format().length));if(n.isValid()===!1)return;if(r.unix()>n.unix())return;return e.substr(moment().format().length)}void 0===i?i=moment().add(24,"hours"):"number"==typeof i&&(i=moment().add(i,"seconds")),e=i.format()+e,localStorage["Chick-api-cache."+t]=e}});Chick.api=function(){return ns.call.apply(ns,arguments)},function(t){function e(i,r,n,o){var s=null;"string"==typeof r?i+="/"+i:"object"==typeof r&&(void 0!==r.include&&"string"!=typeof r.include&&(r.include=r.include.join(",")),s=r);var a=t.Net.Api.createUrl(i);n=_.extend({type:"get",data:s||{},url:a,headers:{"X-Api-Key":t.Net.Api.config.key}},n||{}),o=_.extend({allowCache:!1,cacheExpire:void 0,model:!1,handleErrors:!0},o||{});var c=this;if(o.allowCache===!0){var u=n.type.toUpperCase()+" "+a+"?"+$.param(n.data),h=t.Net.Api.cache(u);if(void 0!==h){var l=new t.Net.ApiResult($.parseJSON(h),i,{model:o.model});return void c.resolve(l,h)}}$.support.cors===!1&&(n.dataType="jsonp",n.data.alt="jsonp",n.data.api_key=t.Net.Api.config.key),this.ajaxCall=$.ajax(n).done(function(e,r,n){var s=new t.Net.ApiResult(e,i,{model:o.model});c.resolve(s,n.responseText),o.allowCache===!0&&t.Net.Api.cache(u,n.responseText,o.cacheExpire)}).fail(function(t){c.reject(t),o.handleErrors!==!1&&e.any.trigger("error",t)})}t.register("Net.ApiCall",t.Core.Promise,e),e.prototype.abort=function(){return this.ajaxCall.abort(),this},e.any=new t.Core.TriggerClass,e.any.__registerEvents(["error"])}(Chick),function(t){function e(t,e,i){this.meta=t.meta,delete t.meta,void 0!==t.linked&&(this.linked=this.__deserializeLinked(t.linked),delete t.linked),this.linkInfo=!1,void 0!==t.links&&(this.linkInfo=t.links,delete t.links);var r=_.extend({model:!1},i);this.rootElement=_.first(_.keys(t)),this.records=this.__deserialize(t[this.rootElement],r.model?r.model:inflection.classify(this.rootElement)),this.linkInfo&&this.__enrichLinks()}t.register("Net.ApiResult",e),e.prototype.each=function(t){return this.records.each(t)},e.prototype.__deserialize=function(e,i){var r="function"==typeof t.Models[i]?t.Models[i]:t.Core.Model,n=new t.Core.Collection(r);return _.each(e,function(t){var e=new r;e.deserialize(t),n.add(e)}),n},e.prototype.__deserializeLinked=function(t){var e={},i=this;return _.each(t,function(t,r){e[r]=i.__deserialize(t,inflection.classify(r))}),e},e.prototype.__enrichLinks=function(){for(var t in this.linkInfo){var e=this.linkInfo[t];if(void 0!==e.type&&void 0!==this.linked[e.type]){var i=t.split("."),r=i[0],n=(i.shift(),i.join("."));r===this.rootElement&&this.records.enrich(n,this.linked[e.type]),void 0!==this.linked[r]&&this.linked[r].enrich(n,this.linked[e.type])}}}}(Chick),function(ns){function Directive(t,e){}ns.register("Gui.Directive",Directive),Directive.enableDirectives=function($el,data,view){for(var createdDirectives={},creationCounts={},tags=_.keys(Chick.directiveClasses),query=tags.join(":not([data-directive]),")+":not([data-directive])",$elements=$el.find(query),q=$elements.length-1;q>=0;q--){var dir=$elements.get(q),options={},broadcastListeners={};_.each(dir.attributes,function(attr){if(/\-on$/.test(attr.name)){var method=attr.name.substr(0,attr.name.length-3),events=attr.value.split(/\s*,\s*/);_.each(events,function(t){void 0===broadcastListeners[t]&&(broadcastListeners[t]=[]),broadcastListeners[t].push(method)})}var value;if(/^chick\-/.test(attr.name)){var name=_.camelize(attr.name.substr(6)),func=function(){return eval(attr.value)};value=func.call(data),options[name]=value}else{if(value=attr.value,""===value||"true"===value)value=!0;else if("false"===value)value=!1;else try{value=JSON.parse(value)}catch(e){}options[_.camelize(attr.name)]=value}});var $directive=$(dir),DirectiveClass=Chick.directiveClasses[dir.tagName.toLowerCase()],directive=new DirectiveClass($directive,options);if(directive.$element=$directive,directive.settings=_.extend({},DirectiveClass.defaultSettings,options),directive.__construct()!==!1){Chick.createdDirectives.push(directive),$directive.attr("data-directive",Chick.createdDirectives.length-1);var name;if(options.id)name=options.id;else{var dirName=_.camelize(dir.tagName.toLowerCase());void 0===creationCounts[dirName]&&(creationCounts[dirName]=0),name=dirName+creationCounts[dirName],creationCounts[dirName]++}createdDirectives[name]=directive,_.each(broadcastListeners,function(t,e){Chick.listen(e,function(e){_.each(t,function(t){directive[t].apply(directive,e)})})})}}return createdDirectives},Directive.prototype.getElement=function(){return this.$element},Directive.prototype.findChildDirectives=function(t,e){var i="[data-directive]";void 0!==t&&(i=t+i),e===!0&&(i=">"+i);var r=[];return this.$element.find(i).each(function(t,e){r.push(Chick.getDirectiveInstance($(e).attr("data-directive")))}),r},Directive.prototype.findTemplate=function(t,e,i){var r=this.$element.find(">"+t),n=r.html();if(n=_.replaceAll(n,"<#","<%"),n=_.replaceAll(n,"&lt;#","<%"),n=_.replaceAll(n,"#>","%>"),n=_.replaceAll(n,"#&gt;","%>"),0===n.length){if(e===!0)throw"The "+this.$element[0].tagName.toLowerCase()+" directive needs a <"+t+"> tag containing an underscore-template, using <# and #>.";return!1}return i!==!1&&r.remove(),new Chick.Gui.Template(n)}}(Chick),function(t){var e=t.register("Gui.I18n");e.language=$("html").attr("lang")||"en",e.baseUrl="lang/:lang/",e.data={},e.numbers={decimal:".",thousands:",",thousandsLength:3,currency:{precision:2}},e.setBaseUrl=function(t){/\/$/.test(t)||(t+="/"),e.baseUrl=t},e.setLanguage=function(t){e.language=t,moment.locale(t)},e.currencyFormat=function(t){return e.numberFormat(t,e.numbers.currency.precision)},e.numberFormat=function(t,i){var r=t.toFixed(i),n=r.split(".");if(n[0].length>e.numbers.thousandsLength){for(var o=/(\d+)(\d{3})/,s=n[0];o.test(s);)s=s.replace(o,"$1"+e.numbers.thousands+"$2");r=s+e.numbers.decimal+n[1]}else r=r.replace(".",e.numbers.decimal);return r},e.switchLanguage=function(t){e.language=t,e.apply()},e.apply=function(t){void 0===t&&(t=$("html")),t.find("[data-i18n]").each(function(t){var i=$(this),r=i.data("i18n").split(",");for(var n in r){var o=r[n].split(":");1===o.length?i.text(e.get(o[0])):i.attr(o[0],o[1])}})},e.replaceLocations=function(t){var i=e.get("locations.abbreviations");for(var r in i){var n=new RegExp(r,"gi");t=t.replace(n,i[r])}return t},e.load=function(i,r,n){void 0===r&&(r=e.language);var o=e.baseUrl.replace(":lang",r)+i+".json";moment.locale(r);var s=t.promise();return $.ajax({url:o}).then(function(i){var r=e.data;void 0!==n&&(r=r[n]),r=t.extend(r,i),void 0!==r.numbers&&(e.numbers=t.extend(e.numbers,r.numbers)),s.resolve(i)}),s},e.get=function(i,r){var n=t.arrayGet(e.data,i,!1);return n?(void 0!==r&&("string"==typeof r?n=n.replace(/\:[a-zA-Z]+/,r):"object"==typeof r&&_.each(r,function(t,e){n=n.replace(":"+e,t)})),n):"["+i+"]"},window.trans=e.get,window.I18n=e}(Chick),function(t){function e(t,e){this.__compiled=_.template(t,e)}t.register("Gui.Template",e),e.prototype.run=function(t){var i=this.__compiled(t);return _.each(e.hooks,function(e){i=e(i,t)}),i},e.prototype.use=function(t,e){return e.html(this.run(t)),e},e.hooks=[],e.hook=function(t){return e.hooks.push(t),e},t.template=function(t,i,r){var n=new e(t);return void 0===r?n.run(i):n.use(i,r)}}(Chick),function(t){function e(t,e,i){this.method=void 0===e?"get":e,this.requestData=void 0===i?{}:i,this.source=t,this.data={},this.forms={},this.template=null,this.__loadPromise=void 0,this.__waitFor=[],this.__waitForLeaveAnimation=!1,this.__registerEvents(["ready","leave","render"])}t.register("Gui.View",t.Core.TriggerClass,e),e.prototype.preloadImage=function(e){var i=t.promise();return $("<img/>").on("load",function(){i.resolve()}).on("error",function(){throw i.resolve(),"Could not find image: "+e}).attr("src",e),this.__waitFor.push(i),this},e.prototype.preloadImages=function(t){for(var e in t)this.preloadImage(t[e]);return this},e.prototype.withJson=function(e,i){var r=e,n=!1;void 0!==i&&(r=i,n=e);var o=t.promise(),s=this;return $.ajax({url:r}).then(function(t){n?s.data[n]=t:s.data=t,o.resolve()}),this.__waitFor.push(o),this},e.prototype.withData=function(e,i,r){var n=e,o=!1;void 0!==i&&(n=i,o=e);var s=t.promise();"object"==typeof n&&"function"==typeof n.then?(n.then(function(t){r?r(s,t):s.resolve(t)}),this.__waitFor.push(s)):s.resolve(n);var a=this;return s.then(function(t){o?a.data[o]=t:a.data=t}),this},e.prototype.withCollection=function(e,i,r){var n=this;return this.withData(e,i,function(e,i){var o=i.records;if(void 0!==r){var s=r.apply(n,[o]);if(s===!1)return void t.app.abort(404);void 0!==s&&(o=s)}e.resolve(o)})},e.prototype.withModel=function(e,i,r){if("object"==typeof i&&!Chick.Core.Model.prototype.isPrototypeOf(i)&&!Chick.Net.ApiCall.prototype.isPrototypeOf(i)){var n=new Chick.Core.Model;n.deserialize(i),i=n}return this.withData(e,i,function(e,i){var n=i.records.first();if(n){if(void 0!==r){var o=r(n);void 0!==o&&(n=o)}e.resolve(n)}else t.app.abort(404)})},e.prototype.onSubmit=function(t,e){return this.forms[t]={name:t,submitCallback:e},this},e.prototype.load=function(){if(void 0!==this.__loadPromise)return this.__loadPromise;this.__loadPromise=t.promise(),this.__waitFor.push(this.__loadPromise);var i=this;return $.ajax({url:e.path+this.source+e.defaultSuffix,data:this.requestData,method:this.method}).then(function(e){i.template=new t.Gui.Template(e),i.__loadPromise.resolve()}).fail(function(t){}),this.__loadPromise},e.prototype.render=function(){this.trigger("render"),e.any.trigger("render",this);var i=t.promise();this.load();var r=this;return t.when(this.__waitFor).then(function(){r.$element=$(r.template.run(r.data)),t.enableContent(r.$element),r.directives=Chick.Gui.Directive.enableDirectives(r.$element,r.data,r),_.each(r.forms,function(t,e){r.$element.find("form[name="+e+"]").on("submit",function(e){e.preventDefault(),t.submitCallback.apply(r,[$(this),e])})}),i.resolve(r.$element),r.trigger("ready"),e.any.trigger("ready",r)}),i},e.prototype.waitForLeaveAnimation=function(t){return this.__waitForLeaveAnimation=void 0===t?!0:t,this},e.prototype.leave=function(i){var r=this.triggerAndReturn("leave",i);if(e.any.trigger("leave",this,i),r.length>0){for(var n=[],o=0;o<r.length;o++){if(r[o]===!1)return!1;t.isPromise(r[o])&&n.push(r[o])}if(n.length>0){if(1===n.length)return n[0];t.promise();return t.when(n)}}return!0},e.make=function(t,i,r){var n=new e(t,i,r);return n},e.any=new Chick.Core.TriggerClass,e.any.__registerEvents(["ready","leave","render"]),e.path="views/",e.defaultSuffix=".jt"}(Chick),function(t){function e(t,e){this.name=t,this.$target=e,this.lastSetByRoute=!1,this.lastSetByRouteParams=!1,this.$target.data("viewcontainer",this)}t.register("Gui.ViewContainer",t.Core.TriggerClass,e),e.prototype.setTarget=function(t){t[0]!==this.$target[0]&&(this.$target=t,this.lastSetByRoute=!1,this.lastSetByRouteParams=!1)},e.prototype.setContent=function(t,e,i){this.lastSetByRoute=e?e:!1,this.lastSetByRouteParams=i,this.$target.html(t),Chick.app.findViewContainers()},e.prototype.isLastSetBy=function(t,e){return this.lastSetByRoute===!1?!1:t.id===this.lastSetByRoute.id&&JSON.stringify(e)===JSON.stringify(this.lastSetByRouteParams)?!0:!1}}(Chick),function(t){function e(e,i){this.__registerEvents(["resize","ready"]);this.$app=e,this.settings=t.extend(!0,{baseUrl:"/",i18n:{bundles:[]},languageInUrl:!1,debug:!0},i),this.readyPromises=[],this.__errorHandlers={},this.__defaultErrorViewContainer="main",this.$window=$(window),this.$body=$("body"),this.$container=this.$app.parent(),
this.$document=$(document),this.viewContainers={},this.router=new t.Core.Router({baseUrl:this.settings.baseUrl}),this.__createListeners(),this.__onResize(),t.app=this,this.findViewContainers()}t.register("Gui.App",t.Core.TriggerClass,e),e.prototype.start=function(){var e=this,i=e.router.detectLanguage();if(i!==!1&&(t.Gui.I18n.setLanguage(i),t.app.language=i),this.settings.i18n.bundles.length>0)for(var r in this.settings.i18n.bundles)this.readyPromises.push(t.Gui.I18n.load(this.settings.i18n.bundles[r]));return t.when(this.readyPromises).then(function(){e.settings.i18n.bundles.length>0&&t.Gui.I18n.apply($("html")),e.trigger("ready"),e.router.start(),e.__onResize()}),this},e.prototype.findViewContainers=function(t){var e=this;void 0===t&&(t=this.$body);var i={};t.find("view, [view]").each(function(t,e){var r=$(e),n=r.is("view")?r.attr("name"):r.attr("view");if(!n)throw"RoutingError: You need to define the name attribute for each <view>.";i[n]=r}),_.each(_.difference(_.keys(this.viewContainers),_.keys(i)),function(t){delete e.viewContainers[t]}),_.each(i,function(t,i){void 0===e.viewContainers[i]?e.viewContainers[i]=new Chick.Gui.ViewContainer(i,t):e.viewContainers[i].setTarget(t)})},e.prototype.getViewContainer=function(t){if(void 0===this.viewContainers[t])throw'RoutingError: Unknown view container "'+t+'"';return this.viewContainers[t]},e.prototype.ready=function(t){var e=this;return this.__promiseReady.then(function(){t.apply(e)}),this},e.prototype.routes=function(t){return t.apply(this.router),this},e.prototype.errors=function(e,i){return this.__errorHandlers=t.extend(this.__errorHandlers,e),void 0!==i&&(this.__defaultErrorViewContainer=i),this},e.prototype.handleError=function(e,i,r){if(r=this.getViewContainer(void 0===r?this.__defaultErrorViewContainer:r),void 0!==this.__errorHandlers[e]){var n=this.__errorHandlers[e](i);t.Gui.View.prototype.isPrototypeOf(n)?n.render().then(function(t){r(t)}):t.isPromise(n)?n.then(function(t){r.setContent(t)}):r.setContent(n)}else r.setContent("Error "+e)},e.prototype.abort=function(t,e){return this.handleError(t,e)},e.prototype.isMobile=function(){return window.innerWidth<750},e.prototype.switchLanguage=function(t){this.router.switchLanguage(t)},e.prototype.__createListeners=function(){var t,e,i=this,r=!1;window.setInterval(function(){var n=!1;window.innerWidth!==t&&(t=window.innerWidth,n=!0),window.innerHeight!==e&&(e=window.innerHeight,n=!0),n&&(r!==!1&&window.clearTimeout(r),r=window.setTimeout(function(){i.__onResize(),r=!1},50))},25),this.router.on("error",function(t,e,r){i.handleError(t,e,r)})},e.prototype.__onResize=function(){var t=this;t.trigger("resize")},t.createApplication=function(e,i){var r=new t.Gui.App(e,i);return r},t.url=function(e){"#"===e[0]&&(e=t.app.router.lastRequest.uri+e);var i=t.app.settings.baseUrl;return"/"===i&&(i=""),void 0!==t.app.language&&t.app.settings.languageInUrl===!0&&(i=i+"/"+t.app.language),i+e}}(Chick);